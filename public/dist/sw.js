(()=>{function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function n(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s;function i(e){var t,n=e.request;if(s&&!(t=c.get(n.url))){var a,i=new RegExp("^".concat(s.mainURL));i.test(n.url)&&(t=null===(a=r.fetch(n.url.replace(i,"")))||void 0===a?void 0:a.then((function(e){return c.addResponse(n,e)})))}t||(t=fetch(n).then((function(e){return c.addResponse(n,e)}))),e.respondWith(t)}self.addEventListener("install",(function(e){})),self.addEventListener("activate",(function(e){})),self.addEventListener("message",(function(e){var t=JSON.parse(e.data),n=t.type,a=t.mes;switch(n){case"update":s&&a.version==s.version||(c.removeAll(),r.update(a.webSocketUrl),r.addMessageEventListener((function(e){var t=JSON.parse(e.data);"scriptUpdate"==t.type&&c.remove(t.mes)}))),s=a;break;case"close":c.removeAll(),r.instance&&r.instance.close(),self.removeEventListener("fetch",i)}})),self.addEventListener("fetch",i);var r=function(){function t(){e(this,t)}return n(t,null,[{key:"update",value:function(e){var t=this;this.m_fetchTaskList.length=0,this.instance&&this.instance.close(),this.instance=new WebSocket(e),this.usable=!0,this.instance.addEventListener("error",(function(){console.error("webSocketÂá∫ÈîôÂï¶ÔºÅüò±"),c.removeAll(),t.usable=!1})),this.addMessageEventListener((function(e){var n=JSON.parse(e.data);"fetch"==n.type&&t._fetch(n.mes)}))}},{key:"fetch",value:function(e){var t=this;if(!this.usable||1!=this.instance.readyState)return null;var n=this.getFetchKey();return new Promise((function(a){t.m_fetchTaskList.push({key:n,resolve:a}),t.instance.send(JSON.stringify({type:"fetch",mes:{url:e,key:n}}))}))}},{key:"_fetch",value:function(e){var t=e.key,n=e.body,a=e.head,s=e.stateCode,i=this.m_fetchTaskList.findIndex((function(e){return e.key==t}));-1!=i?(this.m_fetchTaskList[i].resolve(new Response(n,{headers:a,status:s})),this.m_fetchTaskList.splice(i,1)):console.error("Ê®°ÊãühttpËØ∑Ê±ÇÂá∫ÈîôÔºåÂª∫ËÆÆÈáçÂêØÂ∑•ÂÖ∑„ÄÇ")}},{key:"getFetchKey",value:function(){return btoa("".concat(Date.now(),":").concat(this.getFetchKeyNumber++,":").concat(Math.random()))}},{key:"addMessageEventListener",value:function(e){this.usable&&this.instance.addEventListener("message",e)}}]),t}();a(r,"instance",null),a(r,"usable",!1),a(r,"m_fetchTaskList",[]),a(r,"getFetchKeyNumber",0);var c=function(){function t(){e(this,t)}return n(t,null,[{key:"get",value:function(e){e=e.replace(/\\/g,"/");var t=this.cache.find((function(t){return new RegExp("^".concat(t[0],"$"),"i").test(e)}));if(t)return t[2].clone()}},{key:"addResponse",value:function(e,t){return t.headers.has("file-only-key")&&r.usable&&this.add(e.url,t.headers.get("file-only-key"),t.clone()),t}},{key:"add",value:function(e,t,n){e=e.replace(/\\/g,"/"),this.remove(t),this.cache.push([e,t,n])}},{key:"remove",value:function(e){var t=this.cache.findIndex((function(t){return t[1]==e}));-1!=t&&(console.log("%c%s","color: #8785a2;","> Âà†Èô§swÂ∫üÂºÉÁºìÂ≠òÊñá‰ª∂@".concat(this.cache[t][0].replace(/[a-z]+:\/\/[a-zA-Z0-9\.]+:?[0-9]*/,"")," ‚úñÔ∏è")),this.cache.splice(t,1))}},{key:"removeAll",value:function(){this.cache.length=0}}]),t}();a(c,"cache",[])})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9wdWJsaWMvLi9zcmMvc3cuanMiXSwibmFtZXMiOlsiQ29uZmlnIiwiZmV0Y2hFdmVudCIsImV2ZW50IiwiX3Jlc3BvbnNlIiwicmVxdWVzdCIsImNhY2hlVCIsImdldCIsInVybCIsIl9yZWdFeHAiLCJSZWdFeHAiLCJtYWluVVJMIiwidGVzdCIsIndlYlNvY2tldFQiLCJmZXRjaCIsInJlcGxhY2UiLCJ0aGVuIiwicmVzcG9uc2UiLCJhZGRSZXNwb25zZSIsInJlc3BvbmRXaXRoIiwic2VsZiIsImFkZEV2ZW50TGlzdGVuZXIiLCJKU09OIiwicGFyc2UiLCJkYXRhIiwidHlwZSIsIm1lcyIsInZlcnNpb24iLCJyZW1vdmVBbGwiLCJ1cGRhdGUiLCJ3ZWJTb2NrZXRVcmwiLCJhZGRNZXNzYWdlRXZlbnRMaXN0ZW5lciIsInJlbW92ZSIsImluc3RhbmNlIiwiY2xvc2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiX3VybCIsInRoaXMiLCJtX2ZldGNoVGFza0xpc3QiLCJsZW5ndGgiLCJXZWJTb2NrZXQiLCJ1c2FibGUiLCJjb25zb2xlIiwiZXJyb3IiLCJfZmV0Y2giLCJyZWFkeVN0YXRlIiwiX2tleSIsImdldEZldGNoS2V5IiwiUHJvbWlzZSIsInIiLCJwdXNoIiwia2V5IiwicmVzb2x2ZSIsInNlbmQiLCJzdHJpbmdpZnkiLCJfZGF0YSIsImJvZHkiLCJoZWFkIiwic3RhdGVDb2RlIiwiX2luZGV4IiwiZmluZEluZGV4IiwiaXRlbSIsIlJlc3BvbnNlIiwiaGVhZGVycyIsInN0YXR1cyIsInNwbGljZSIsImJ0b2EiLCJEYXRlIiwibm93IiwiZ2V0RmV0Y2hLZXlOdW1iZXIiLCJNYXRoIiwicmFuZG9tIiwiX2YiLCJjYWNoZSIsImZpbmQiLCJjbG9uZSIsImhhcyIsImFkZCIsImxvZyJdLCJtYXBwaW5ncyI6IjJiQVVBLElBQUlBLEVBc0NKLFNBQVNDLEVBQVdDLEdBQ2hCLElBQ0lDLEVBREFDLEVBQVVGLEVBQU1FLFFBR3BCLEdBQUlK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J2luc3RhbGwnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgIC8vIOWkhOeQhuWuieijheatpemqpFxyXG4gICAgLy8gY29uc29sZS5sb2coJ3N3IGluc3RhbGwnKTtcclxufSk7XHJcbnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignYWN0aXZhdGUnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgIC8vIOWkhOeQhuWuieijheatpemqpFxyXG4gICAgLy8gY29uc29sZS5sb2coJ3N3IGFjdGl2YXRlJyk7XHJcbn0pO1xyXG5cclxuLyoqIGVzYnVpbGTphY3nva4gKi9cclxubGV0IENvbmZpZztcclxuXHJcbi8v55uR5ZCs5raI5oGvXHJcbnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgbGV0IHsgdHlwZSwgbWVzIH0gPSBKU09OLnBhcnNlKGV2ZW50LmRhdGEpO1xyXG4gICAgLy9cclxuICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgIC8v5Yid5aeL5YyWXHJcbiAgICAgICAgY2FzZSAndXBkYXRlJzpcclxuICAgICAgICAgICAgLy/mn6XnnIvlpJbpg6jniYjmnKzlkozlvZPliY3ov5vnqIvniYjmnKzmmK/lkKbkuIDoh7TvvIzkuI3kuIDoh7TnmoTor53muIXnqbrnvJPlrZjvvIzmm7TmlrB3ZWJTb2NrZXRcclxuICAgICAgICAgICAgaWYgKCFDb25maWcgfHwgbWVzLnZlcnNpb24gIT0gQ29uZmlnLnZlcnNpb24pIHtcclxuICAgICAgICAgICAgICAgIGNhY2hlVC5yZW1vdmVBbGwoKTtcclxuICAgICAgICAgICAgICAgIHdlYlNvY2tldFQudXBkYXRlKG1lcy53ZWJTb2NrZXRVcmwpO1xyXG4gICAgICAgICAgICAgICAgLy/lnKjmt7vliqDkuovku7ZcclxuICAgICAgICAgICAgICAgIHdlYlNvY2tldFQuYWRkTWVzc2FnZUV2ZW50TGlzdGVuZXIoKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGEgPSBKU09OLnBhcnNlKGV2ZW50LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCfmm7TmlrDmtojmga8nLCBfdHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy/mm7TmlrDohJrmnKxcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS50eXBlID09ICdzY3JpcHRVcGRhdGUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlVC5yZW1vdmUoZGF0YS5tZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8v6YeN572u6YWN572u5L+h5oGvXHJcbiAgICAgICAgICAgIENvbmZpZyA9IG1lcztcclxuICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgLy/lhbPpl61cclxuICAgICAgICBjYXNlICdjbG9zZSc6XHJcbiAgICAgICAgICAgIGNhY2hlVC5yZW1vdmVBbGwoKTtcclxuICAgICAgICAgICAgd2ViU29ja2V0VC5pbnN0YW5jZSAmJiB3ZWJTb2NrZXRULmluc3RhbmNlLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIC8v5Y+W5raI6K+35rGC5Luj55CGXHJcbiAgICAgICAgICAgIHNlbGYucmVtb3ZlRXZlbnRMaXN0ZW5lcignZmV0Y2gnLCBmZXRjaEV2ZW50KTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuLyoqIOivt+axguS6i+S7tiAqL1xyXG5mdW5jdGlvbiBmZXRjaEV2ZW50KGV2ZW50KSB7XHJcbiAgICBsZXQgcmVxdWVzdCA9IGV2ZW50LnJlcXVlc3Q7XHJcbiAgICBsZXQgX3Jlc3BvbnNlO1xyXG4gICAgLy/lnKjmnInphY3nva7nmoTmg4XlhrXkuIvlhYjlnKjnvJPlrZjkuK3mib7lk43lupRcclxuICAgIGlmIChDb25maWcpIHtcclxuICAgICAgICBfcmVzcG9uc2UgPSBjYWNoZVQuZ2V0KHJlcXVlc3QudXJsKTtcclxuICAgICAgICAvL+eUqHdlYlNjb2NrZXTmqKHmi59odHRw6K+35rGC77yM6YG/5byA5rWP6KeI5ZmoaHR0cOivt+axguW5tuWPkemZkOWItlxyXG4gICAgICAgIGlmICghX3Jlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIC8v5qOA5rWL5piv5ZCm5piv6ISa5pys6K+35rGCXHJcbiAgICAgICAgICAgIGxldCBfcmVnRXhwID0gbmV3IFJlZ0V4cChgXiR7Q29uZmlnLm1haW5VUkx9YCk7XHJcbiAgICAgICAgICAgIGlmIChfcmVnRXhwLnRlc3QocmVxdWVzdC51cmwpKSB7XHJcbiAgICAgICAgICAgICAgICBfcmVzcG9uc2UgPSB3ZWJTb2NrZXRULmZldGNoKHJlcXVlc3QudXJsLnJlcGxhY2UoX3JlZ0V4cCwgJycpKT8udGhlbigocmVzcG9uc2UpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FjaGVULmFkZFJlc3BvbnNlKHJlcXVlc3QsIHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy/lpoLmnpzov5jmmK/msqHmib7liLDliJnnm7TmjqXlj5HpgIHkuIDkuKpodHRw6K+35rGCXHJcbiAgICBpZiAoIV9yZXNwb25zZSkge1xyXG4gICAgICAgIC8v5Y+R6YCB6K+35rGCXHJcbiAgICAgICAgX3Jlc3BvbnNlID0gZmV0Y2gocmVxdWVzdCkudGhlbigocmVzcG9uc2UpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGNhY2hlVC5hZGRSZXNwb25zZShyZXF1ZXN0LCByZXNwb25zZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvL+aLpuaIquivt+axglxyXG4gICAgZXZlbnQucmVzcG9uZFdpdGgoXHJcbiAgICAgICAgX3Jlc3BvbnNlLFxyXG4gICAgKTtcclxufVxyXG4vL+ebkeWQrOivt+axglxyXG5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2ZldGNoJywgZmV0Y2hFdmVudCk7XHJcblxyXG4vKipcclxuICogd2ViU29ja2V05bel5YW3XHJcbiAqL1xyXG5jbGFzcyB3ZWJTb2NrZXRUIHtcclxuICAgIC8qKiDlrp7kvosgKi9cclxuICAgIHN0YXRpYyBpbnN0YW5jZSA9IG51bGw7XHJcbiAgICAvKiog5piv5ZCm5Y+v55SoICovXHJcbiAgICBzdGF0aWMgdXNhYmxlID0gZmFsc2U7XHJcbiAgICAvKiog6K+35rGC5Lu75Yqh5YiX6KGoICovXHJcbiAgICBzdGF0aWMgbV9mZXRjaFRhc2tMaXN0ID0gW107XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmm7TmlrBcclxuICAgICAqL1xyXG4gICAgc3RhdGljIHVwZGF0ZShfdXJsKSB7XHJcbiAgICAgICAgLy/ph43nva7or7fmsYJcclxuICAgICAgICB0aGlzLm1fZmV0Y2hUYXNrTGlzdC5sZW5ndGggPSAwO1xyXG4gICAgICAgIC8v5YWI5YWz6Zet5LmL5YmN55qE6L+e5o6lXHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZSAmJiB0aGlzLmluc3RhbmNlLmNsb3NlKCk7XHJcbiAgICAgICAgLyoqIOW8gOWQr+aWsOeahOi/nuaOpSAqL1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2UgPSBuZXcgV2ViU29ja2V0KF91cmwpO1xyXG4gICAgICAgIHRoaXMudXNhYmxlID0gdHJ1ZTtcclxuICAgICAgICAvL3dlYlNvY2tldOmUmeivr+eahOWbnuiwg1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2UuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ3dlYlNvY2tldOWHuumUmeWVpu+8gfCfmLEnKTtcclxuICAgICAgICAgICAgLy/muIXnqbrmiYDmnInnvJPlrZhcclxuICAgICAgICAgICAgY2FjaGVULnJlbW92ZUFsbCgpO1xyXG4gICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICB0aGlzLnVzYWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8v5re75Yqg5LiA5Liq55So5p2l5qih5oufaHR0cOivt+axgueahOWbnuiwg1xyXG4gICAgICAgIHRoaXMuYWRkTWVzc2FnZUV2ZW50TGlzdGVuZXIoKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBkYXRhID0gSlNPTi5wYXJzZShldmVudC5kYXRhKTtcclxuICAgICAgICAgICAgLy/liKTmlq3mmK/kuI3mmK/or7fmsYJcclxuICAgICAgICAgICAgaWYgKGRhdGEudHlwZSA9PSAnZmV0Y2gnKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9mZXRjaChkYXRhLm1lcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWPkemAgeS4gOS4queUqHdlYlNvY2tldOaooeaLn+eahGh0dHDor7fmsYJcclxuICAgICAqIEBwYXJhbSB7Kn0gX3VybCDor7fmsYLlnLDlnYBcclxuICAgICAqL1xyXG4gICAgc3RhdGljIGZldGNoKF91cmwpIHtcclxuICAgICAgICBpZiAoIXRoaXMudXNhYmxlIHx8IHRoaXMuaW5zdGFuY2UucmVhZHlTdGF0ZSAhPSAxKSB7IHJldHVybiBudWxsOyB9XHJcbiAgICAgICAgbGV0IF9rZXkgPSB0aGlzLmdldEZldGNoS2V5KCk7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyKSA9PiB7XHJcbiAgICAgICAgICAgIC8v5re75Yqg5Yiw5Lu75YqhXHJcbiAgICAgICAgICAgIHRoaXMubV9mZXRjaFRhc2tMaXN0LnB1c2goe1xyXG4gICAgICAgICAgICAgICAga2V5OiBfa2V5LFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZTogcixcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIC8v5Y+R6YCB6K+35rGCXHJcbiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2Uuc2VuZChKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiAnZmV0Y2gnLFxyXG4gICAgICAgICAgICAgICAgbWVzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBfdXJsLFxyXG4gICAgICAgICAgICAgICAgICAgIGtleTogX2tleSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIH0pKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8vXHJcbiAgICBzdGF0aWMgX2ZldGNoKF9kYXRhKSB7XHJcbiAgICAgICAgbGV0IHsga2V5LCBib2R5LCBoZWFkLCBzdGF0ZUNvZGUgfSA9IF9kYXRhO1xyXG4gICAgICAgIGxldCBfaW5kZXggPSB0aGlzLm1fZmV0Y2hUYXNrTGlzdC5maW5kSW5kZXgoKGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW0ua2V5ID09IGtleTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAoX2luZGV4ICE9IC0xKSB7XHJcbiAgICAgICAgICAgIHRoaXMubV9mZXRjaFRhc2tMaXN0W19pbmRleF0ucmVzb2x2ZShuZXcgUmVzcG9uc2UoYm9keSwgeyBoZWFkZXJzOiBoZWFkLCBzdGF0dXM6IHN0YXRlQ29kZSB9KSk7XHJcbiAgICAgICAgICAgIC8v5Yig6Zmk5Lu75YqhXHJcbiAgICAgICAgICAgIHRoaXMubV9mZXRjaFRhc2tMaXN0LnNwbGljZShfaW5kZXgsIDEpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+aooeaLn2h0dHDor7fmsYLlh7rplJnvvIzlu7rorq7ph43lkK/lt6XlhbfjgIInKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvL1xyXG4gICAgc3RhdGljIGdldEZldGNoS2V5TnVtYmVyID0gMDtcclxuICAgIHN0YXRpYyBnZXRGZXRjaEtleSgpIHtcclxuICAgICAgICByZXR1cm4gYnRvYShgJHtEYXRlLm5vdygpfToke3RoaXMuZ2V0RmV0Y2hLZXlOdW1iZXIrK306JHtNYXRoLnJhbmRvbSgpfWApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5re75Yqg5raI5oGv5LqL5Lu2XHJcbiAgICAgKiBAcGFyYW0ge30gX2Yg5Zue6LCDXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBhZGRNZXNzYWdlRXZlbnRMaXN0ZW5lcihfZikge1xyXG4gICAgICAgIHRoaXMudXNhYmxlICYmIHRoaXMuaW5zdGFuY2UuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgX2YpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICog57yT5a2Y5bel5YW3XHJcbiAqIOe8k+WtmOWIsOi/m+eoi+WGheWtmOS4rVxyXG4gKi9cclxuY2xhc3MgY2FjaGVUIHtcclxuICAgIC8qKiDnvJPlrZjlhoXlrrnvvIxbX3VybCxfa2V5LF9yZXNwb25zZV1bXSAqL1xyXG4gICAgc3RhdGljIGNhY2hlID0gW107XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmoLnmja7kuIDkuKror7fmsYLot6/lvoTojrflj5bnvJPlrZhcclxuICAgICAqIEBwYXJhbSB7Kn0gX3VybCDor7fmsYLot6/lvoRcclxuICAgICAqL1xyXG4gICAgc3RhdGljIGdldChfdXJsKSB7XHJcbiAgICAgICAgLy/lhajpg6jovazmiJDnu5/kuIDnmoTot6/lvoRcclxuICAgICAgICBfdXJsID0gX3VybC5yZXBsYWNlKC9cXFxcL2csICcvJyk7XHJcbiAgICAgICAgbGV0IF9kYXRhID0gdGhpcy5jYWNoZS5maW5kKChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIC8v5LiN5Yy65YiG5aSn5bCP5YaZ5Yy56YWNXHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVnRXhwKGBeJHtpdGVtWzBdfSRgLCAnaScpLnRlc3QoX3VybCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICBpZiAoX2RhdGEpIHtcclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ+S7jue8k+WtmOS4reWPluW+l+i1hOa6kCcsIF91cmwpO1xyXG4gICAgICAgICAgICByZXR1cm4gX2RhdGFbMl0uY2xvbmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmt7vliqDlk43lupRcclxuICAgICAqIEBwYXJhbSB7Kn0gcmVxdWVzdCDor7fmsYJcclxuICAgICAqIEBwYXJhbSB7Kn0gcmVzcG9uc2Ug5ZON5bqUXHJcbiAgICAgKiBAcmV0dXJucyDljp/lk43lupRcclxuICAgICAqL1xyXG4gICAgc3RhdGljIGFkZFJlc3BvbnNlKHJlcXVlc3QsIHJlc3BvbnNlKSB7XHJcbiAgICAgICAgLy/liKTmlq1yZXNwb25zZeeahOWTjeW6lOWktO+8jOaYr+WQpuW6lOivpea3u+WKoOWIsOe8k+WtmOS4reOAglxyXG4gICAgICAgIGlmIChyZXNwb25zZS5oZWFkZXJzLmhhcygnZmlsZS1vbmx5LWtleScpKSB7XHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCfmt7vliqDov5vnvJPlrZgnLCByZXNwb25zZSk7XHJcbiAgICAgICAgICAgIC8v5re75Yqg5Yiw57yT5a2Y5Lit77yM5rOo5oSP77yM5b+F6aG75re75Yqg5YWL6ZqG5p2/77yM5LiN54S25Y+q6IO955So5LiA5qyh77yM6KaB5Yik5pat5b2T5YmNd2ViU29ja2V05pyJ5rKh5pyJ55So77yM5LiN54S25re75Yqg5LiK5Y675rKh5rOV5pu05paw5Lmf5rKh5pyJ5oSP5LmJXHJcbiAgICAgICAgICAgIGlmICh3ZWJTb2NrZXRULnVzYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZGQocmVxdWVzdC51cmwsIHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdmaWxlLW9ubHkta2V5JyksIHJlc3BvbnNlLmNsb25lKCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8v6L+U5Zue5ZON5bqUXHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5re75Yqg5LiA5Liq57yT5a2YXHJcbiAgICAgKiBAcGFyYW0geyp9IF91cmwgdXJsXHJcbiAgICAgKiBAcGFyYW0geyp9IF9rZXkg5ZSv5LiA6ZSu5YC8XHJcbiAgICAgKiBAcGFyYW0geyp9IF9yZXNwb25zZSDlk43lupRcclxuICAgICAqL1xyXG4gICAgc3RhdGljIGFkZChfdXJsLCBfa2V5LCBfcmVzcG9uc2UpIHtcclxuICAgICAgICAvL+WFqOmDqOi9rOaIkOe7n+S4gOeahOi3r+W+hFxyXG4gICAgICAgIF91cmwgPSBfdXJsLnJlcGxhY2UoL1xcXFwvZywgJy8nKTtcclxuICAgICAgICAvL+WmguaenOaciee8k+WtmOeahOivneWwseWFiOWIoOmZpCznoa7kv53lj6rmnInkuIDkuKrnvJPlrZjkuI7lkI7nq6/mlofku7blr7nlupRcclxuICAgICAgICB0aGlzLnJlbW92ZShfa2V5KTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHRoaXMuY2FjaGUucHVzaChbX3VybCwgX2tleSwgX3Jlc3BvbnNlXSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliKDpmaTkuIDkuKrnvJPlrZhcclxuICAgICAqIEBwYXJhbSB7Kn0gX2tleSDllK/kuIDplK7lgLxcclxuICAgICAqL1xyXG4gICAgc3RhdGljIHJlbW92ZShfa2V5KSB7XHJcbiAgICAgICAgbGV0IF9pbmRleCA9IHRoaXMuY2FjaGUuZmluZEluZGV4KChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtWzFdID09IF9rZXk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKF9pbmRleCAhPSAtMSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnJWMlcycsICdjb2xvcjogIzg3ODVhMjsnLCBgPiDliKDpmaRzd+W6n+W8g+e8k+WtmOaWh+S7tkAke3RoaXMuY2FjaGVbX2luZGV4XVswXS5yZXBsYWNlKC9bYS16XSs6XFwvXFwvW2EtekEtWjAtOVxcLl0rOj9bMC05XSovLCAnJyl9IOKclu+4j2ApO1xyXG4gICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICB0aGlzLmNhY2hlLnNwbGljZShfaW5kZXgsIDEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWIoOmZpOaJgOaciee8k+WtmFxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgcmVtb3ZlQWxsKCkge1xyXG4gICAgICAgIHRoaXMuY2FjaGUubGVuZ3RoID0gMDtcclxuICAgIH1cclxufSJdLCJzb3VyY2VSb290IjoiIn0=